<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#f1f5f9">
    <title>BMS - Expense Management</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar glass-panel">
        <div class="nav-brand">BMS System</div>
        <button class="menu-toggle"><i class="fas fa-bars"></i></button>
        <ul class="nav-links">
            <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
            <li><a href="purchase.html" class="nav-link">Purchase</a></li>
            <li><a href="sale.html" class="nav-link">Sale</a></li>
            <li><a href="expense.html" class="nav-link active">Expense</a></li>
            <li><a href="reports.html" class="nav-link">Reports</a></li>
            <li><a href="admin.html" class="nav-link">Admin</a></li>
            <li><a href="#" class="nav-link" id="logoutBtn">Logout</a></li>
        </ul>
    </nav>

    <div class="container" style="display: flex; gap: 2rem; flex-wrap: wrap;">
        <!-- Main Content -->
        <div style="flex: 1; min-width: 0;">
            <!-- Financial Summary Cards -->
            <h2 style="margin-bottom: 1.5rem;">Financial Overview</h2>
            <div class="card-grid" style="margin-bottom: 2rem;">
                <div class="glass-panel card">
                    <h3>Total Sales</h3>
                    <div class="value" id="totalSales">Rs. 0</div>
                </div>
                <div class="glass-panel card">
                    <h3>Total Expenses</h3>
                    <div class="value" id="totalExpenses" style="color: #ef4444;">Rs. 0</div>
                </div>
                <div class="glass-panel card">
                    <h3>Net Profit</h3>
                    <div class="value" id="netProfit">Rs. 0</div>
                </div>
            </div>

            <!-- Add Expense Form -->
            <div class="glass-panel" style="padding: 2rem; margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1.5rem;">Add New Expense</h2>
                <form id="expenseForm">
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                        <div class="form-group">
                            <label>Expense Name</label>
                            <input type="text" id="eName" required placeholder="e.g. Electricity Bill">
                        </div>
                        <div class="form-group">
                            <label>Amount (Rs.)</label>
                            <input type="number" id="eAmount" required min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="eDate" required>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary" style="margin-top: 1rem;">Add Expense</button>
                </form>
            </div>

            <!-- Expense History -->
            <div class="glass-panel" style="padding: 2rem;">
                <h2 style="margin-bottom: 1rem;">Expense History</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Expense Name</th>
                                <th>Amount (Rs.)</th>
                            </tr>
                        </thead>
                        <tbody id="expenseTableBody">
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Vertical Banner Sidebar -->
        <div class="vertical-banner-container" style="width: 120px; flex-shrink: 0; display: none;">
            <div class="glass-panel"
                style="width: 120px; height: 240px; overflow: hidden; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.05);">
                <img id="verticalBannerImg" src="" style="width: 100%; height: 100%; object-fit: cover; display: none;"
                    onerror="this.style.display='none'">
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Check Auth
        app.checkAuth(ROLES.USER);

        // Load Vertical Banner
        const vBanner = app.getVerticalBanner();
        if (vBanner) {
            document.querySelector('.vertical-banner-container').style.display = 'block';
            const img = document.getElementById('verticalBannerImg');
            img.src = vBanner;
            img.style.display = 'block';
        }

        // Set Today's Date
        document.getElementById('eDate').valueAsDate = new Date();

        function loadExpenses() {
            const expenses = app.getExpenses();
            const tbody = document.getElementById('expenseTableBody');
            tbody.innerHTML = '';

            // Sort by Date Descending
            expenses.sort((a, b) => new Date(b.date) - new Date(a.date));

            expenses.forEach(exp => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${exp.date}</td>
                    <td>${exp.name}</td>
                    <td>Rs. ${exp.amount.toFixed(2)}</td>
                `;
                tbody.appendChild(tr);
            });

            // Update Summary
            const financial = app.getFinancialSummary();
            document.getElementById('totalSales').textContent = `Rs. ${financial.totalSales.toLocaleString()}`;
            document.getElementById('totalExpenses').textContent = `Rs. ${financial.totalExpenses.toLocaleString()}`;

            const profitEl = document.getElementById('netProfit');
            profitEl.textContent = `Rs. ${financial.netProfit.toLocaleString()}`;
            if (financial.netProfit >= 0) {
                profitEl.style.color = '#22c55e'; // Green
            } else {
                profitEl.style.color = '#ef4444'; // Red
            }
        }

        document.getElementById('expenseForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('eName').value;
            const amount = document.getElementById('eAmount').value;
            const date = document.getElementById('eDate').value;

            if (app.addExpense(name, amount, date)) {
                alert('Expense Added Successfully');
                document.getElementById('expenseForm').reset();
                document.getElementById('eDate').valueAsDate = new Date();
                loadExpenses();
            } else {
                alert('Failed to add expense');
            }
        });

        loadExpenses();
    </script>
</body>

</html>